(function(){
window.shown=window.shown||[];window.shown.conversions=window.shown.conversions||[];
const i={appendScriptToHead({id:e,src:t,innerText:n}){const o=document.createElement("script");e&&(o.id=e),t&&(o.src=t,o.async=!0,o.onerror=()=>console.error(`Error loading script: ${t}`)),n&&(o.textContent=n),document.head.appendChild(o)},insertHTMLBeforeEnd(e,t){e.insertAdjacentHTML("beforeend",t)}};function d(e,t){return t.match_attribute==="url"?t.match_type==="exact"&&e===t.match_pattern||t.match_type==="contains"&&e.replace(/\/$/,"").includes(t.match_pattern.replace(/\/$/,"")):!1}function s(e){if(!e||!e.global_tag_ids||e.global_tag_ids.length===0){console.error("No global tag IDs provided.");return}const t=e.global_tag_ids[0];if(!t){console.error("First global tag ID is not valid.");return}const n="shown-0";if(!document.getElementById(n)){const o=window.location.href;let a="window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date());";a+=e.global_tag_ids.map(r=>`gtag('config', '${r}');`).join(""),a+=e.conversions.filter(r=>d(o,r.trigger_setting)).map(r=>r.event).join(""),i.appendScriptToHead({id:n,src:`https://www.googletagmanager.com/gtag/js?id=${t}`}),i.appendScriptToHead({innerText:a})}}function u(e){if(!e||!e.conversions||e.conversions.length===0)return;const t=new Set;e.conversions.forEach(a=>t.add(a.tracking_code));const n=Array.from(t).join(""),o=document.createRange().createContextualFragment(n);document.head.appendChild(o)}function p(e){if(!e||!e.conversions||e.conversions.length===0)return;const t=e.conversions.reduce((n,o)=>n+o.tracking_code,"");t&&i.insertHTMLBeforeEnd(document.head,t)}const c={google:0,facebook:2,bing:1};function f(e,t){switch(parseInt(e,10)){case c.google:s(t);break;case c.facebook:u(t);break;case c.bing:p(t);break}}function l(e){document.readyState==="complete"||document.readyState==="interactive"?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.attachEvent("onreadystatechange",function(){document.readyState==="complete"&&e()})}document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("shown_add_to_cart",e=>{const t=e.detail;if(console.log("purchaseData shown_add_to_cart",t),!t)return;const n={item_id:t.product_id.toString()};if(t.quantity&&(n.quantity=t.quantity),t.currency&&(n.currency=t.currency),t.price&&(n.price=t.price),typeof gtag=="function"&&gtag("event","add_to_cart",{items:[n]}),typeof fbq=="function"){let o={content_ids:[n.item_id],content_type:"product"};n.price&&(o.value=n.price),n.currency&&(o.currency=n.currency),fbq("track","AddToCart",o)}}),document.body.addEventListener("shown_reaching_checkout",()=>{console.log("Reacted to shown_reaching_checkout"),typeof gtag=="function"&&gtag("event","begin_checkout"),typeof fbq=="function"&&fbq("track","InitiateCheckout")}),document.body.addEventListener("shown_adding_billing_details",()=>{console.log("Reacted to shown_adding_billing_details"),typeof gtag=="function"&&gtag("event","add_payment_info"),typeof fbq=="function"&&fbq("track","add_payment_info")}),document.body.addEventListener("shown_purchase_completed",e=>{const t=e.detail;if(console.log("Reacted to shown_purchase_completed",t),!!t&&(t.transaction_id&&t.transaction_id,t.amount&&t.amount,t.currency&&t.currency,typeof gtag=="function"&&gtag("event","purchase",t),typeof fbq=="function")){let n={};t.amount&&(n.value=t.amount),t.currency&&(n.currency=t.currency),fbq("track","Purchase",n)}})});l(()=>{const{conversions:e={}}=window.shown||{};Object.keys(e).length!==0&&Object.entries(e).forEach(([t,n])=>{if(!t||!n){console.error(`Missing configuration for platform: ${t}`);return}try{f(t,n)}catch{}})});
})();
window.addEventListener("message",(event)=>{if(event.origin!=="https://app.shown.io")return;event.source.postMessage({shown_analytics_check_flag:true,},event.origin)},!1)
